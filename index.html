<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychedelic Trance Festivals - Interactive World Map</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    
    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; background-color: #f5f5f5; color: #333; }
        #header { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: white; padding: 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        #header h1 { margin: 0; font-size: 26px; }
        #header p { margin: 8px 0 0; font-size: 15px; color: #4cc9f0; }
        #container { display: flex; height: calc(100vh - 110px); }
        #sidebar { width: 300px; background: white; padding: 20px; overflow-y: auto; box-shadow: 2px 0 10px rgba(0,0,0,0.1); z-index: 1000; }
        #map { flex: 1; height: 100%; }

        /* CIRCULAR FLAGS */
        .flag-marker-container {
            width: 32px; height: 32px; border-radius: 50%; overflow: hidden;
            border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.4);
            display: flex; align-items: center; justify-content: center; background: #eee;
        }
        .flag-marker-container img { height: 100%; width: auto; object-fit: cover; }
        .genre-indicator {
            position: absolute; bottom: -2px; right: -2px; width: 12px; height: 12px;
            border-radius: 50%; border: 2px solid white; z-index: 1001;
        }

        .filter-section { margin-bottom: 20px; }
        .filter-section h3 { font-size: 16px; border-bottom: 2px solid #4cc9f0; padding-bottom: 5px; margin-bottom: 10px; }
        .filter-option { margin: 5px 0; font-size: 14px; }
        .stats { background: #f8f9fa; padding: 10px; border-radius: 5px; font-size: 14px; }
        .status-active { color: #2ecc71; font-weight: bold; }
        .status-inactive { color: #e74c3c; font-weight: bold; }
        
        @media (max-width: 768px) {
            #container { flex-direction: column; }
            #sidebar { width: 100%; height: 200px; }
        }
    </style>
</head>
<body>

<div id="header">
    <h1>Psychedelic Trance Festivals - Interactive World Map</h1>
    <p>Click on the country icon and select the festival.</p>
</div>

<div id="container">
    <div id="sidebar">
        <div class="filter-section">
            <h3>üéõÔ∏è Status</h3>
            <div class="filter-option"><label><input type="checkbox" id="filter-active" checked> Active</label></div>
            <div class="filter-option"><label><input type="checkbox" id="filter-inactive" checked> Inactive</label></div>
        </div>
        <div class="filter-section">
            <h3>üåç Continent</h3>
            <div class="filter-option"><label><input type="checkbox" class="continent-filter" value="Europa" checked> Europe</label></div>
            <div class="filter-option"><label><input type="checkbox" class="continent-filter" value="Am√©rica do Sul" checked> South America</label></div>
            <div class="filter-option"><label><input type="checkbox" class="continent-filter" value="Am√©rica do Norte" checked> North America</label></div>
            <div class="filter-option"><label><input type="checkbox" class="continent-filter" value="√Åsia" checked> Asia</label></div>
            <div class="filter-option"><label><input type="checkbox" class="continent-filter" value="√Åfrica" checked> Africa</label></div>
        </div>
        <div class="stats">
            <strong>Statistics:</strong><br>
            Total: <span id="total-festivals">0</span><br>
            Active: <span id="active-festivals" class="status-active">0</span>
        </div>
    </div>
    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
    const countryCodes = {
        'Fran√ßa': 'fr', 'Brasil': 'br', 'Cro√°cia': 'hr', 'Portugal': 'pt', 'Hungria': 'hu',
        'Alemanha': 'de', '√Åustria': 'at', 'Su√≠√ßa': 'ch', 'Gr√©cia': 'gr', 'Espanha': 'es',
        'It√°lia': 'it', 'B√©lgica': 'be', 'Holanda': 'nl', 'Rep√∫blica Tcheca': 'cz',
        'Dinamarca': 'dk', '√çndia': 'in', 'Tail√¢ndia': 'th', 'Jap√£o': 'jp', 'Israel': 'il',
        'EUA': 'us', 'M√©xico': 'mx', '√Åfrica do Sul': 'za', 'Turquia': 'tr'
    };

    // SEUS DADOS COMPLETOS RESTAURADOS
    const festivals = [
        { name: "Nataraja Festival", country: "Fran√ßa", continent: "Europa", genre: "Psytrance - multig√™nero", status: "Ativo", lat: 46.0201, lng: 3.7616 },
        { name: "Universo Paralello", country: "Brasil", continent: "Am√©rica do Sul", genre: "Psytrance - multig√™nero", status: "Ativo", lat: -13.512251, lng: -38.92635 },
        { name: "Mo.dem Festival", country: "Cro√°cia", continent: "Europa", genre: "Darkpsy", status: "Ativo", lat: 45.216951, lng: 15.471648 },
        { name: "Boom Festival", country: "Portugal", continent: "Europa", genre: "Psytrance - multig√™nero", status: "Ativo", lat: 39.9254, lng: -7.2349 },
        { name: "Ozora Festival", country: "Hungria", continent: "Europa", genre: "Psytrance - multig√™nero", status: "Ativo", lat: 46.7725, lng: 18.4418 },
        { name: "Antaris Project", country: "Alemanha", continent: "Europa", genre: "Psytrance - multig√™nero", status: "Ativo", lat: 52.6841, lng: 12.3891 },
        { name: "Shankra Festival", country: "Su√≠√ßa", continent: "Europa", genre: "Psytrance - multig√™nero", status: "Ativo", lat: 46.4713, lng: 8.9416 },
        { name: "Free Earth Festival", country: "Gr√©cia", continent: "Europa", genre: "Psytrance - multig√™nero", status: "Ativo", lat: 40.2333, lng: 23.5000 },
        { name: "Hadra Trance Festival", country: "Fran√ßa", continent: "Europa", genre: "Psytrance - multig√™nero", status: "Ativo", lat: 45.1885, lng: 5.7245 },
        { name: "S.U.N. Festival", country: "Hungria", continent: "Europa", genre: "Psytrance - multig√™nero", status: "Ativo", lat: 47.9255, lng: 19.1528 },
        { name: "Own Spirit Festival", country: "Espanha", continent: "Europa", genre: "Psytrance - multig√™nero", status: "Ativo", lat: 41.9167, lng: 0.3167 },
        { name: "7 Chakras Festival", country: "It√°lia", continent: "Europa", genre: "Psytrance - multig√™nero", status: "Ativo", lat: 41.8919, lng: 12.5113 },
        { name: "Waldfrieden Wonderland", country: "Alemanha", continent: "Europa", genre: "Psytrance - multig√™nero", status: "Ativo", lat: 52.3486, lng: 8.3514 },
        { name: "ZNA Gathering", country: "Portugal", continent: "Europa", genre: "Retro Psytrance", status: "Ativo", lat: 39.2311, lng: -7.8922 },
        { name: "Master of Puppets", country: "Rep√∫blica Tcheca", continent: "Europa", genre: "Hitech Psytrance", status: "Ativo", lat: 49.1951, lng: 16.6068 },
        { name: "Masters of Puppets Festival", country: "Rep√∫blica Tcheca", continent: "Europa", genre: "Hitech Psytrance", status: "Ativo", lat: 49.2002, lng: 15.6001 },
        { name: "VooV Experience", country: "Alemanha", continent: "Europa", genre: "Psytrance - multig√™nero", status: "Ativo", lat: 53.2167, lng: 12.0167 },
        { name: "Psycrowdelica Festival", country: "Alemanha", continent: "Europa", genre: "Darkpsy", status: "Inativo", lat: 52.5200, lng: 13.4050 },
        { name: "Lost Theory Festival", country: "Espanha", continent: "Europa", genre: "Darkpsy", status: "Inativo", lat: 40.4168, lng: -3.7038 },
        { name: "Hilltop Festival", country: "√çndia", continent: "√Åsia", genre: "Psytrance - multig√™nero", status: "Ativo", lat: 15.5937, lng: 73.7412 },
        { name: "Experience Festival", country: "Tail√¢ndia", continent: "√Åsia", genre: "Psytrance - multig√™nero", status: "Ativo", lat: 9.4319, lng: 99.9961 }
    ];

    const map = L.map('map').setView([20, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    const markerGroups = { active: L.layerGroup().addTo(map), inactive: L.layerGroup().addTo(map) };

    function getGenreColor(genre) {
        if (genre.includes('Hitech')) return '#ff0055';
        if (genre.includes('Dark')) return '#7b2cbf';
        return '#4361ee';
    }

    function getFestivalIcon(festival) {
        const code = countryCodes[festival.country];
        const flagUrl = code ? `https://flagcdn.com/w80/${code.toLowerCase()}.png` : null;
        const color = getGenreColor(festival.genre);
        
        return L.divIcon({
            className: 'custom-icon',
            html: `<div style="position: relative;">
                    <div class="flag-marker-container">
                        ${flagUrl ? `<img src="${flagUrl}">` : `<div style="background:#ccc;width:100%;height:100%"></div>`}
                    </div>
                    <div class="genre-indicator" style="background-color: ${color};"></div>
                   </div>`,
            iconSize: [32, 32], iconAnchor: [16, 16]
        });
    }

    function addMarkers() {
        markerGroups.active.clearLayers();
        markerGroups.inactive.clearLayers();
        
        const showActive = document.getElementById('filter-active').checked;
        const showInactive = document.getElementById('filter-inactive').checked;
        const selectedContinents = Array.from(document.querySelectorAll('.continent-filter:checked')).map(cb => cb.value);

        let activeCount = 0;

        festivals.forEach(festival => {
            if (!selectedContinents.includes(festival.continent)) return;
            if (festival.status === 'Ativo' && !showActive) return;
            if (festival.status === 'Inativo' && !showInactive) return;

            const marker = L.marker([festival.lat, festival.lng], { icon: getFestivalIcon(festival) });
            const code = countryCodes[festival.country];
            const flagUrl = code ? `https://flagcdn.com/w80/${code.toLowerCase()}.png` : null;

            marker.bindPopup(`
                <div style="min-width:150px">
                    <h3 style="margin:0; font-size:16px; display:flex; align-items:center;">
                        ${flagUrl ? `<img src="${flagUrl}" style="width:20px; margin-right:8px">` : ''} ${festival.name}
                    </h3>
                    <p style="margin:5px 0; font-size:13px;"><b>Genre:</b> ${festival.genre}<br>
                    <b>Status:</b> <span class="status-${festival.status === 'Ativo' ? 'active' : 'inactive'}">${festival.status === 'Ativo' ? 'Active' : 'Inactive'}</span></p>
                </div>
            `);

            if (festival.status === 'Ativo') {
                markerGroups.active.addLayer(marker);
                activeCount++;
            } else {
                markerGroups.inactive.addLayer(marker);
            }
        });

        document.getElementById('total-festivals').textContent = festivals.length;
        document.getElementById('active-festivals').textContent = activeCount;
    }

    document.getElementById('filter-active').addEventListener('change', addMarkers);
    document.getElementById('filter-inactive').addEventListener('change', addMarkers);
    document.querySelectorAll('.continent-filter').forEach(cb => cb.addEventListener('change', addMarkers));

    addMarkers();
</script>
</body>
</html>
